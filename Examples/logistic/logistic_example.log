-----------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\GitHub\federated-fpm\Examples\logistic\logistic_example.log
  log type:  text
 opened on:   4 Apr 2024, 15:14:11

. // logistic regression low birth weight exmaple
. set seed 3425

. webuse lbw
(Hosmer & Lemeshow data)

. // create center variables
. gen center = runiformint(1,3)

. tab center, gen(center)

     center |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         59       31.22       31.22
          2 |         66       34.92       66.14
          3 |         64       33.86      100.00
------------+-----------------------------------
      Total |        189      100.00

. 
. // Fit model in Stata
. logit low age smoke center2 center3

Iteration 0:  Log likelihood =   -117.336  
Iteration 1:  Log likelihood = -113.26066  
Iteration 2:  Log likelihood = -113.22731  
Iteration 3:  Log likelihood =  -113.2273  

Logistic regression                                     Number of obs =    189
                                                        LR chi2(4)    =   8.22
                                                        Prob > chi2   = 0.0839
Log likelihood = -113.2273                              Pseudo R2     = 0.0350

------------------------------------------------------------------------------
         low | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0495248    .032056    -1.54   0.122    -.1123535    .0133039
       smoke |   .6980077   .3235882     2.16   0.031     .0637865    1.332229
     center2 |  -.1657076    .400908    -0.41   0.679    -.9514729    .6200578
     center3 |   .1860336   .3930343     0.47   0.636    -.5842995    .9563667
       _cons |   .0438213   .7882377     0.06   0.956    -1.501096    1.588739
------------------------------------------------------------------------------

. estimates store logit

. 
. 
. // Now using mlad - write likelhood file in Python
. // The dataset is first split into 3 parts to 
. // represent 3 centers using setup.py
. // I use nojit as this helps when developing
. gen cons = 1

. mlad  (xb: low  = age smoke center2 center3), ///
>       llfile(logistic)                        ///
>       pysetup(setup)                          ///
>       othervars(low) othervarnames(y)         ///
>       nojit

Initial:      Log likelihood = -131.00482
Alternative:  Log likelihood = -119.10055
Rescale:      Log likelihood = -118.20646
Iteration 0:  Log likelihood = -118.20646  
Iteration 1:  Log likelihood = -113.30244  
Iteration 2:  Log likelihood =  -113.2273  
Iteration 3:  Log likelihood =  -113.2273  

. ml display

                                                        Number of obs =    189
                                                        Wald chi2(4)  =   7.83
Log likelihood = -113.2273                              Prob > chi2   = 0.0980

------------------------------------------------------------------------------
         low | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0495248    .032056    -1.54   0.122    -.1123535    .0133039
       smoke |   .6980078   .3235882     2.16   0.031     .0637866    1.332229
     center2 |  -.1657076   .4009081    -0.41   0.679    -.9514729    .6200578
     center3 |   .1860336   .3930343     0.47   0.636    -.5842995    .9563668
       _cons |   .0438217   .7882377     0.06   0.956    -1.501096    1.588739
------------------------------------------------------------------------------

. estimates store mlad 

. 
. // compare estimates and standard errors from Stata and Python
. estimates table logit mlad, stats(ll) se eq(1)

----------------------------------------
    Variable |   logit         mlad     
-------------+--------------------------
         age | -.04952482   -.04952484  
             |  .03205605    .03205605  
       smoke |  .69800766    .69800777  
             |  .32358817    .32358817  
     center2 | -.16570756   -.16570759  
             |  .40090804    .40090805  
     center3 |   .1860336    .18603361  
             |  .39303433    .39303434  
       _cons |  .04382134    .04382174  
             |  .78823772    .78823775  
-------------+--------------------------
          ll |  -113.2273    -113.2273  
----------------------------------------
                            Legend: b/se

. 
. // some useful mlad options
. //   -- nojit - do not jit compile - get better error messages when developing
. //   -- mlmethod(d0) - Python just gives likelihood will use numerical derivatives
. //   -- mlmethod(d1) - Python just gives likelihood and gradient 
. //                     Hessian calculated numerically
. //   -- mlmethod(d1debug) gradient - compares gradient from Python with numeric derivatives
. //   -- mlmethod(d2debug) hessian  - compares hessian from Python with numeric derivatives
. //   -- most ml options will work, e.g for initial values / tolerance etc
. log close
      name:  <unnamed>
       log:  C:\GitHub\federated-fpm\Examples\logistic\logistic_example.log
  log type:  text
 closed on:   4 Apr 2024, 15:14:19
-----------------------------------------------------------------------------------------------------------------------------------------------
