
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      18.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: 15-user 4-core network perpetual
Serial number: 501806323575
  Licensed to: Severin Elvatun
               CRN

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased; see help
          set_maxvar.

. do "ml_optimizer.do" 

. // - can stata optimizer accept arbitrary initial values?
. // - can fix number of steps in optimizer?
. 
. // Simulate some survival data 
. 
. set obs 500000
Number of observations (_N) was 0, now 500,000.

. set seed 987123

. 
. gen x1 = rnormal()

. gen x2 = rnormal()

. 
. survsim t d, dist(weibull) lambda(0.2) gamma(0.8) maxt(5) cov(x1 0.1 x2 0.1)

. 
. // stset declares the data in memory to be st data, informing 
. // Stata of key variables and their roles in a survival-time 
. // analysis
. stset t, failure(d=1)

Survival-time data settings

         Failure event: d==1
Observed time interval: (0, t]
     Exit on or before: failure

--------------------------------------------------------------------------
    500,000  total observations
          0  exclusions
--------------------------------------------------------------------------
    500,000  observations remaining, representing
    258,175  failures in single-record/single-failure data
  1,703,093  total analysis time at risk and under observation
                                                At risk from t =         0
                                     Earliest observed entry t =         0
                                          Last observed exit t =         5

. 
. set maxiter 0

. 
. // To fit the Weibull model using ml, a separate module 
. // returns the log-likelhood (scalar). 
. ml model d0 weibull_d0 (ln_lambda: = x1 x2) (ln_gamma:), maximize 

Iteration 0:  Log likelihood = -1703093.1  
convergence not achieved

. 
. set maxiter 3

. 
. // To fit the Weibull model using ml, a separate module 
. // returns the log-likelhood (scalar). 
. ml model d0 weibull_d0 (ln_lambda: = x1 x2) (ln_gamma:), maximize 

Initial:      Log likelihood = -1703093.1
Alternative:  Log likelihood = -872315.77
Rescale:      Log likelihood = -806348.45
Rescale eq:   Log likelihood = -764593.08
Iteration 0:  Log likelihood = -764593.08  
Iteration 1:  Log likelihood = -734592.41  
Iteration 2:  Log likelihood = -734446.28  
Iteration 3:  Log likelihood = -734446.19  
convergence not achieved

. 
end of do-file
